<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Intentions - Accueil</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="menu-container"></div>

    <main id="app-content">
        <header>
            <h1>Tableau de bord</h1>
            <p id="status-badge" style="color: orange;">Connexion à la base de données...</p>
        </header>
        
        <section class="dashboard-cards">
            <div class="card">
                <h3>Messes du jour</h3>
                <p id="today-masses">Chargement du calendrier...</p>
            </div>

            <div class="card">
                <h3>Intentions en attente</h3>
                <p id="pending-intentions" style="font-size: 2em; font-weight: bold;">0</p>
                <a href="intentions.html" class="btn-link">Voir les demandes</a>
            </div>
        </section>

        <section id="recent-activity" style="margin-top: 30px;">
            <h3>Dernières activités</h3>
            <div id="activity-log">
                Aucune intention enregistrée pour le moment.
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script src="config.js"></script>
    
    <script>
        async function checkConnection() {
            const statusBadge = document.getElementById('status-badge');
            
            try {
                // Test de lecture sur la table 'intentions'
                const { data, error } = await supabase
                    .from('intentions')
                    .select('*')
                    .limit(1);

                if (error) throw error;

                statusBadge.innerText = "● Base de données connectée";
                statusBadge.style.color = "green";
                console.log("Connexion Supabase réussie !");
                
                // On appelle la fonction pour compter les intentions en attente
                countPendingIntentions();

            } catch (err) {
                statusBadge.innerText = "● Erreur de connexion";
                statusBadge.style.color = "red";
                console.error("Erreur:", err.message);
            }
        }

        async function countPendingIntentions() {
            const { count, error } = await supabase
                .from('intentions')
                .select('*', { count: 'exact', head: true })
                .eq('statut', 'en_attente');

            if (!error) {
                document.getElementById('pending-intentions').innerText = count || 0;
            }
        }

        // Lancement au chargement de la page
        window.onload = checkConnection;
    </script>
    
    <script src="menu.js"></script>
</body>
</html>
